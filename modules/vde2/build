
# -*- mode: shell-script;  -*-

set -e

ORIGIN="http://downloads.sourceforge.net/project/vde/vde2/2.3.2/vde2-2.3.2.tar.gz"
MD5=d3f3e979558e396b8405c4613df9dfa0


parse_inputs
if test -z $DESTINATION ; then
  DESTINATION=$(pwd)/root
fi 

BUILD_STEPS=(
    "rm -rf source root && mkdir -p source root"
    "tar -xzvf $(get_md5_path $MD5) -C source"
    "cd source/vde2-2.3.2"
#    "autoreconf -fi"
    "./configure --prefix=${DESTINATION} --enable-experimental"
    "make && make install "
)

NEW_BUILD_CHECKS=(
    "test -f root/bin/vdecmd"
)

SPOT_CHECKS=(
    "true"
)

debug "calling get for vde2 source"
get --origin $ORIGIN --md5 $MD5

debug "calling build for vde2 source"
build --build-steps BUILD_STEPS[@] \
      --build-checks NEW_BUILD_CHECKS[@] \
      --spot-checks SPOT_CHECKS[@] \
      --md5 $MD5
